{% load publication_extras %}
<table class="more_fields_tab">
    <tbody>
    {% for publication_form in publication_formset.forms %}
        <tr>
            {% if publication_form.non_field_errors %}
                <div class="alert alert-danger" role="alert">{{ publication_form.non_field_errors }}</div>
            {% endif %}
            <td>
                {{ publication_form.id }}
                {{ publication_form.DELETE.as_hidden }}
                {{ publication_form.crossref_metadata }}
            </td>
            <td>
              <div class="publication_div">
                {% if publication_form.instance.id %}
                {% include "rcallocation/field.html" with field=publication_form.output_type hide=True %}
                {% include "rcallocation/field.html" with field=publication_form.doi hide=True %}
                {% include "rcallocation/field.html" with field=publication_form.publication hide=True %}
                <div name="description-text">
                  {% autoescape on %}
                  {{ publication_form.instance|pub_summary }}
                  {% endautoescape %}
                </div>
                {% else %}
                {% include "rcallocation/field.html" with field=publication_form.output_type %}
                <div name="prompts-group">
                  <div>
                    All recently published books and papers should have a
                    Digital Object Identifier (DOI) issued by the publisher.
                    We need you to find and provide us with that DOI, if it
                    exists.
                  </div>
                  <button type="button" name="have-doi"
                          class="btn btn-default">I have a DOI to enter
                  </button>
                  <button type="button" name="no-doi"
                          class="btn btn-default">I have no DOI
                  </button>
                </div>
                {% include "rcallocation/field.html" with field=publication_form.doi button="check-doi" button_text="Check DOI" %}
                {% include "rcallocation/field.html" with field=publication_form.publication %}
                <div name='details-group' {% if publication_form.crossref_metadata|length == 0 %} hidden {% endif %} >
                  <label>Publication details (from crossref)</label>
                  <div name='details-text'>
                    {% autoescape on %}
                    {{ publication_form.crossref_metadata.value|crossref_summary }}
                    {% endautoescape %}
                  </div>
                </div>
                {% endif %}
              </div>
            </td>
            <td>
              <button class="pull-right btn btn-default"
                      id="delete-publication" type="button">
                Delete
              </button>
            </td>
        </tr>
    {% endfor %}
    </tbody>
    <tfoot>
        <tr>
            <td></td>
            <td class="add_another_row"><input type="button" class="btn btn-default" value="Add publication" id="add_another"></td>
            <td></td>
        </tr>
    </tfoot>
</table>
